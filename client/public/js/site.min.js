/*! Room43.in - v0.0.1 */function Eye(a,b,c,d){this.radius=c,this.x=a,this.y=b,this.color=d}function Eyeball(a,b,c,d,e){this.radius=c,this.x=a,this.y=b,this.startX=a,this.startY=b,this.canvasX=0,this.canvasY=0,this.max=d,this.color=e}function Head(a,b,c,d){this.radius=c,this.x=a,this.y=b,this.color=d}function Mouth(a,b,c,d,e){this.radius=c,this.x=a,this.y=b,this.headH=d,this.canvasY=0,this.happy=!0,this.normal=!1,this.color=e}function Guy(a){if(this.options=a||{},!window.HTMLCanvasElement)return void console.log("HTML5 Canvas Element is not supported!");a=a||{},this.appendElement=a.appendElement||document.body;var b=a.scale||1;this.domElement=document.createElement("canvas"),a.position&&(this.domElement.style.position=a.position),this.domElement.style.left=(a.x||0)+"px",this.domElement.style.top=(a.y||0)+"px",this.domElement.style.zIndex="999",this.domElement.width=120*b,this.domElement.height=120*b,this.color=a.color||"#1B1918";var c=this.domElement.getContext("2d"),d=this,e=new Head(60*b,60*b,50*b,this.color),f=new Eye(43*b,60*b,15*b,this.color),g=new Eye(77*b,60*b,15*b,this.color),h=new Eyeball(43*b,60*b,6*b,f.radius-7*b,this.color),i=new Eyeball(77*b,60*b,6*b,g.radius-7*b,this.color),j=new Mouth(60*b,70*b,20*b,50*b,this.color),k=function(a){var b=0,c=0;do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{x:b,y:c}};this.appendElement.appendChild(this.domElement);var l=k(this.domElement);h.canvasX=l.x,i.canvasX=l.x,h.canvasY=l.y,i.canvasY=l.y,j.canvasY=l.y,c.lineWidth=3*b,c.lineCap="round",window.addEventListener("mousemove",function(a){var m=a.pageX,n=a.pageY;void 0!==d.options.position&&"fixed"===d.options.position&&(m=a.pageX-(window.scrollX||0),n=a.pageY-(window.scrollY||0)),l=k(d.domElement),h.canvasX=l.x,i.canvasX=l.x,h.canvasY=l.y,i.canvasY=l.y,j.canvasY=l.y,h.follow(m,n),i.follow(m,n),j.follow(m,n),c.clearRect(0,0,120*b,120*b),e.paint(c),f.paint(c),g.paint(c),h.paint(c),i.paint(c),j.paint(c)},!1),e.paint(c),f.paint(c),g.paint(c),h.paint(c),i.paint(c),j.paint(c)}angular.module("videoconference",["ui.router"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(a,b,c){var d={"public":"public",anon:"anon"};a.state("home",{url:"/",templateUrl:"home",controller:"HomeCtrl"}),a.state("about",{url:"/about",templateUrl:"about.index",data:{access:d.public}}).state("about.team",{url:"/team",templateUrl:"about.team",controller:"InfoCtrl"}).state("about.privacy",{url:"/privacy",template:"Privacy",controller:"InfoCtrl"}).state("about.terms",{url:"/terms",template:"Terms",controller:"InfoCtrl"}).state("about.contact",{url:"/contact",template:"Contact",controller:"InfoCtrl"}).state("about.jobs",{url:"/jobs",template:"Jobs",controller:"InfoCtrl"}),a.state("room",{"abstract":!0,template:"<ui-view/>",data:{access:d.public}}).state("room.join",{url:"/:roomName",templateUrl:"room",controller:"RoomCtrl"}),b.otherwise("/404"),b.rule(function(a,b){if("file"!==b.protocol()){var c,d=b.path(),e=b.search();if("/"!==d[d.length-1])return 0===Object.keys(e).length?d+"/":(c=[],angular.forEach(e,function(a,b){c.push(b+"="+a)}),d+"/?"+c.join("&"))}}),c.html5Mode(!0)}]).run(["$rootScope","$state","$location","$window",function(a,b,c,d){a.$on("$stateChangeStart",function(){}),a.$on("$stateChangeSuccess",function(){d.ga&&d.ga("send","pageview",{page:c.path()})})}]),angular.module("videoconference").factory("webrtc",function(){return{init:function(){return new SimpleWebRTC({localVideoEl:"localVideo",remoteVideosEl:"remotes",autoRequestMedia:!0,debug:!1,detectSpeakingEvents:!0,autoAdjustMic:!1})}}}),angular.module("videoconference").factory("guid",function(){return function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}()}),angular.module("videoconference").factory("fluidGrid",function(){var a,b=angular.element;return function(c){return function(d){function e(a,b){var b=b||.75,c=a.width*b;return c>a.height?{height:a.height,width:a.height/b}:{width:a.width,height:a.width*b}}function f(c,d){var f,g,h,i,j,k,l,m,n,o,p,q,r=Math.floor,s=b(c),t=s.length,u=function(){var a=!!s.find(".focused").length;return a&&t>1?t-1:a&&1===t?1:t}(),v=window.innerWidth,w=window.innerHeight-140,x=v,y=w,z=15,A=.75;if(d&&(a=b(d)[0]),a&&!b(a).parent().length&&(a=void 0),a&&!b(a).hasClass("focused")&&(a=void 0),q=a&&u>1,s.height(y),q)f=u-1,g=1,y=.2*w;else{if(0===u)return;1===u?(f=1,g=1):2===u?x>y?(f=2,g=1):(f=1,g=2):3===u?x>y?(f=3,g=1):(f=1,g=3):4===u?(f=2,g=2):5===u?(f=3,g=2):6===u?x>y?(f=3,g=2):(f=2,g=3):u>6&&(f=u-1,g=1,y=.2*w,a=s.get(0),q=!0)}if(j=e({width:x/f,height:y/g}),h=f-1,i=g-1,k=j.width*f,l=function(){var a=k-z*h;return a/f}(),m=(x-k)/2,n=l*A,o=g*n,p=(y-o)/2,q&&(s=s.not(".focused")),s.each(function(a){var c=a,d=r(c/f),e=c%f,g=12,h=function(){if(3===f){if(0===e)return 1;if(1===e)return 0;if(2===e)return-1}else{if(2===f)return g=5,1==e?-1:1;if(1===f)return 0}}(),i="rotateY("+h*g+"deg)";0===h&&(i+=" scale(.98)");var k;k=q?.8*w+p+"px":d*j.height+p+"px",b(this).css({top:k,left:e*j.width+m+"px",width:l+"px",height:n+"px",position:"absolute"})}),q){var A=a.videoHeight/a.videoWidth;b(a).find("video").length&&(A=b(a).find("video").get(0).videoHeight/b(a).find("video").get(0).videoWidth);var B=e({height:.8*w,width:v},A);b(a).css({top:0,height:B.height,width:B.width,left:v/2-B.width/2})}}f(c,d)}}}),angular.module("videoconference").factory("SoundEffectManager",function(){return function(){function a(){this.AudioContext=window.AudioContext||window.webkitAudioContext,this.support=!!this.AudioContext,this.support&&(this.context=new this.AudioContext),this.sounds={},this.sources={}}return a.prototype.loadFile=function(a,b,c,d){this.support?this._loadWebAudioFile(a,b,c,d):this._loadWaveFile(a.replace(".mp3",".wav"),b,c,3,d)},a.prototype._loadWebAudioFile=function(a,b,c,d){if(this.support){var e=this,f=new XMLHttpRequest;f.open("GET",a,!0),f.responseType="arraybuffer",f.onload=function(){e.context.decodeAudioData(f.response,function(a){e.sounds[b]=a,d&&d(null,a)},function(a){d&&d(a)})},setTimeout(function(){f.send()},c||0)}},a.prototype._loadWaveFile=function(a,b,c,d,e){var f=this,g=d||3;setTimeout(function(){var c,d=0;for(f.sounds[b]=[];g>d;)c=new Audio,c.src=a,0===d&&e&&c.addEventListener("canplaythrough",e,!1),c.load(),f.sounds[b][d++]=c},c||0)},a.prototype._playWebAudio=function(a,b){var c=this.sounds[a];if(c&&(!b||!this.sources[a])){var d=this.context.createBufferSource();d.buffer=c,d.loop=b,d.connect(this.context.destination),b&&(this.sources[a]=d),d.start(0)}},a.prototype._playWavAudio=function(a,b){var c,d=this.sounds[a],e=d&&d.length||0,f=0;if(d)for(;e>f;){if(c=d[f++],c.error)return;if(0===c.currentTime||c.currentTime===c.duration)return c.currentTime=0,c.loop=!!b,f=e,c.play()}},a.prototype.play=function(a,b){return this.support?void this._playWebAudio(a,b):this._playWavAudio(a,b)},a.prototype.stop=function(a){if(this.support)this.sources[a]&&(this.sources[a].stop(0),delete this.sources[a]);else for(var b,c=this.sounds[a],d=c&&c.length||0,e=0;d>e;)b=c[e++],b.pause(),b.currentTime=0},a}()}),angular.module("videoconference").factory("sounds",["SoundEffectManager",function(a){return function(){var b=new a;return b.loadFile("/sounds/online.mp3","online"),b.loadFile("/sounds/offline.mp3","offline"),b}}]),angular.module("videoconference").controller("HomeCtrl",["$scope","$location","$state","$window","guid",function(a,b,c,d,e){new Guy({appendElement:document.getElementById("faceGuy"),color:"#D53972"});a.createRoom=function(a){var b=a.toLowerCase().replace(/\s/g,"-").replace(/[^A-Za-z0-9_\-]/g,"")||e();c.go("room.join",{roomName:b})}}]),angular.module("videoconference").controller("RoomCtrl",["$scope","$state","$stateParams","$window","fluidGrid","sounds",function(a,b,c,d,e,f){var g={};g.roomName=c.roomName,g.participants=0,g.shuffle=e("#remotes >"),g.player=f(),g.$=angular.element,g.api=new SimpleWebRTC({url:"/",localVideoEl:"localVideo",remoteVideosEl:null,autoRequestMedia:!1,debug:!1,detectSpeakingEvents:!0,autoAdjustMic:!1}),g.handleVideoClick=function(a){if("localVideo"!=a.target.id){var b=angular.element(a.target).parent().parent(),c=b.hasClass("focused");angular.element(".videocontainer").removeClass("focused"),c?g.shuffle():(b.addClass("focused"),g.shuffle(b.get(0)))}},g.handleVideoAdded=function(b,c){var d=g;d.player.play("online"),c&&(c.videoEl=b),b.oncontextmenu=function(){return!1};var e=g.$('<div class="videocontainer"><div><!-- video is prepended here--><div class="connectioninfo"><div class="connectionstate"></div><div class="connectionhelp"></div></div><span class="muted"><i class="ss-icon">volume</i>Muted audio</span><span class="paused"><i class="ss-icon">videocamera </i>Video paused</span></div></div>');e.attr("id","videocontainer_"+(c?g.api.getDomId(c):"localScreen")),e.find(">div").prepend(b),e.addClass("focusable"),d.$("#remotes").append(e),b.videoStartTime=Date.now(),b.play(),b.onresize=function(){d.shuffle()},c&&(c.hasdata=!1,c.firstconnect=!0),b.onloadedmetadata=function(){},b.onloadeddata=function(){e.find(".connectionstate").hide(),c&&(c.hasdata=!0)},d.shuffle(),d.$(b).bind("click",d.handleVideoClick),setTimeout(function(){a.$apply(function(){a.participants=d.$("#remotes video").length})},100)},g.handleVideoRemoved=function(b,c){var d=(Date.now()-b.videoStartTime,g);d.player.play("offline"),d.$("#videocontainer_"+(c?d.api.getDomId(c):b.id)).remove(),d.shuffle(),setTimeout(function(){a.$apply(function(){a.participants=d.$("#remotes video").length})},100)},g.handleEndCallClick=function(){g.api.stopScreenShare(),g.api.stopLocalVideo(),g.api.disconnect(),b.go("home")},g.api.startLocalVideo(),g.api.on("videoAdded",g.handleVideoAdded),g.api.on("videoRemoved",g.handleVideoRemoved),g.api.on("readyToCall",function(a){g.roomName?(g.api.joinRoom(g.roomName),console.log("joined sessionid: "+a)):alert("joint fail")}),g.api.on("joinedRoom",function(b){console.log("joined success, roomName: "+b),setTimeout(function(){a.$apply(function(){a.joined=!0})},100)}),g.$(d).bind("resize",function(){g.shuffle()}),a.participants=0,a.roomName=g.roomName,a.link2Share="room43.in/"+g.roomName,a.handleVideoClick=g.handleVideoClick,a.endCallClick=g.handleEndCallClick}]),angular.module("videoconference").controller("InfoCtrl",["$scope","$location",function(a,b){return this.createZoom=function(a){b.path("/"+a)},a.InfoCtrl=this}]),angular.module("videoconference").directive("clickAutoselect",function(){return{restrict:"A",link:function(a,b){b.bind("click",function(){this.focus(),this.select()})}}}),angular.module("videoconference").directive("dancingDots",function(){return function(a,b){!function(){var a=0;window.setInterval(function(){for(var c="",d=0;a>d;d++)c+=".";b.text(c),3!==a?a+=1:a=0},1e3)}()}}),angular.module("simplewebrtc",["simplewebrtc"]).factory("SimpleWebRTC",function(){return SimpleWebRTC}).directive("screenshare",["SimpleWebRTC",function(a){return{restrict:"AE",template:'<div id="simplewebrtc-local"></div><div id="simplewebrtc-remote"></div>',link:function(b,c,d){var e=new a({localVideoEl:"simplewebrtc-local",remoteVideosEl:"simplewebrtc-remote",autoRequestMedia:!0});e.on("readyToCall",function(){e.joinRoom(d.room)})}}}]),Mouth.prototype={paint:function(a){a.beginPath(),this.happy?a.arc(this.x,this.y,this.radius,Math.PI/4,3*Math.PI/4,!1):this.normal?(a.moveTo(this.x-this.radius,this.y+this.radius),a.lineTo(this.x+this.radius,this.y+this.radius)):a.arc(this.x,this.y+2*this.radius,this.radius,-Math.PI/4,-3*Math.PI/4,!0),a.strokeStyle=this.color,a.stroke(),a.closePath()},follow:function(a,b){Math.abs(this.y+this.canvasY-b)<=this.headH?(this.normal=!0,this.happy=!1):(this.normal=!1,this.happy=this.y+this.canvasY>b?!1:!0)}},Head.prototype={paint:function(a){a.beginPath(),a.arc(this.x,this.y,this.radius,0,2*Math.PI,!0),a.strokeStyle=this.color,a.stroke(),a.closePath()}},Eye.prototype={paint:function(a){a.beginPath(),a.arc(this.x,this.y,this.radius,0,2*Math.PI,!0),a.strokeStyle=this.color,a.stroke(),a.closePath()}},Eyeball.prototype={follow:function(a,b){if(Math.abs(a-this.startX)>this.max||Math.abs(b-this.startY)>this.max){var c=Math.atan2(b-(this.startY+this.canvasY),a-(this.startX+this.canvasX)),d=Math.cos(c)*this.max,e=Math.sin(c)*this.max;this.x=this.startX+d,this.y=this.startY+e}},paint:function(a){a.beginPath(),a.arc(this.x,this.y,this.radius,0,2*Math.PI,!0),a.fillStyle=this.color,a.fill(),a.closePath()}};